# Инструкция по развертыванию (DEPLOY.md)

## Требования
* **OS:** Linux (рекомендуется Amazon Linux 2 или Ubuntu 22.04) на AWS c8i.large.
* **CPU:** Минимум 2 физических ядра (для пиннинга потоков).
* **Rust:** Nightly (для некоторых оптимизаций, если используются) или Stable 1.75+.

## Сборка (Build)

### 1. Developer Mode (Windows/Linux)
Обычная сборка для тестов.
```bash
cargo build
```

### 2. Production Mode (AWS c8i)
Максимальная оптимизация под архитектуру процессора (avx512 и т.д.).
```bash
RUSTFLAGS="-C target-cpu=native" cargo build --release
```

## Запуск (Run)

### Важно: Привилегии
Для привязки потоков к ядрам (thread pinning) требуются права, либо настройки `cgroups`. Обычно запускаем через `sudo` или с `cap_sys_nice`.

```bash
# Запуск с логами в stdout
sudo ./target/release/hft_rust
```

## Конфигурация
Параметры зашиты в код (hardcoded) для минимизации runtime-чеков в горячем пути, но ключи API должны быть в переменных окружения (в будущем):
- На данный момент ключи тестовые (`TEST_API_KEY`).

## Проверка работоспособности
1. Лог должен показать `HOT Thread pinned to Core ID: ...`.
2. Должно появиться сообщение `WebSocket Upgraded`.
3. При получении данных в консоли будут `[PERF]` метрики.

## Troubleshooting
* **Failed to pin thread:** Убедитесь, что на машине доступно минимум 2 ядра и вы запускаете с правами администратора.
* **Latency spikes:** Проверьте `htop`, убедитесь, что другие процессы не занимают ядра 0 и 1. Используйте `isolcpus` в grub.
